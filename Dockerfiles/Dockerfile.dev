# ============================================
# Development Stage
# ============================================
FROM node:22.14.0-slim

# Install curl for health checks and clean up in same layer to reduce size
RUN apt-get update && \
    apt-get install -y --no-install-recommends curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/app

# Set development environment variables
ENV WEB_NODE_ENV=development
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV NODE_OPTIONS="--max-old-space-size=4096"

# Copy package files for dependency installation
COPY package.json yarn.lock ./

# Install all dependencies (including devDependencies for development)
RUN yarn install --frozen-lockfile

# Copy the rest of the code to the container
# Note: In development, source code is typically mounted as a volume
# so this COPY may be overridden by docker-compose volume mounts
COPY . .

# Expose development server port
EXPOSE 3000

# Start development server with hot reload
CMD ["yarn", "start:dev"]
